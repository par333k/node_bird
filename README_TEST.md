##어플리케이션 테스트

### 유닛 테스트 또는 단위테스트

- jest 패키지 사용
- 작은 단위의 함수나 모듈이 의도된 대로 정확히 작동하는지 테스트 하는 것.
- 본 함수를 수정하게 되면 테스트도 함께 수정되어야 한다.
- 미들웨어 테스트의 경우 미들웨어를 분리해서 테스트해야함  
- 테스트 코드의 객체는 가짜 객체, 가짜 함수를 만들어 진행 (모킹mocking)
- 함수를 모킹할 때는 jest.fn 메서드 이용

* 테스트 커버리지
    - jest --coverage 명렁어
    - 전체 코드 중에서 테스트되고 있는 코드의 비율과 테스트되고 있지 않은 코드의 위치를 알려주는 기능
    - 커버율 100%를 목표로!
    - %Stmts (구문 비율), File(파일과 폴더 이름), %Branch(if문 등의 분기점 비율), %Funcs(함수 비율), %Lines(코드 줄 수 비율), Uncovered Line #s(커버되지 않은 줄 위치)
    - 퍼센티지가 높을 수록 많은 코드가 테스트되었다는 뜻
    - 명시적으로 테스트하고 require한 코드만 커버리지 분석이 된다

### 통합 테스트

- supertest 패키지 를 통해서 테스트
- 통합테스트는 데이터베이스 코드를 모킹하지 않으므로 데이터베이스에 실제로 테스트용 데이터가 저장됨, 따라서 테스트용 DB를 준비하는 것이 좋다.
- config.json의 test 속성의 정보를 통해 테스트 환경 설정
- supertest를 사용하면 app.listen을 수행하지 않고도 서버 라우터 실행이 가능하다.

### 스트레스 테스트

- artillery 패키지 사용
- npx artillery quick --count 100 -n 50 http://localhost:8001
    - 100명의 가상 사용자가 총 5000번 요청하는 방식
    - response time 또는 request latency 를 주목
    - 하위 95와 중간값의 차이가 크지 않는것이 좋음
    - 실제 테스트를 할 때는 스테이징 서버(실서버와 환경이 같은 백업서버)에 부하 테스트 진행
    - json 형태의 시나리오 파일을 통해 시나리오 테스트 가능
- 일반적으로 요청-응답시 데이터베이스 접근 혹은 I/O 작업이 시간이 오래걸림. 이걸 줄이는 기법(데이터 캐싱 등)을 잘 활용해야함
- 테스트는 같은 설정값으로 여러번 해보는 것이 좋다.

### 시스템 테스트

- QA가 테스트 목록을 두고 체크해 나가는 방식

### 인수 테스트

- 알파/베타 테스트처럼 특정 사용자 집단이 실제 서비스를 사용하는 것처럼 진행하는 테스트


#### 테스트 주의사항

* 테스트를 작성한다고 해서 에러가 발생하지 않는 것은 아니다.
* 테스트를 올바르게 작성하지 않으면 테스트를 하지 않는 것보다 못한 상황 발생
* 테스트를 작성하면 나중에 코드 변경 사항이 생겼을 때 어떤 부분에 영향을 미치는지 쉽게 파악이 가능
* 실제 서비스에서는 모든 기능을 테스트하기가 어려우므로 우선순위를 정하여 우선순위가 높은 기능 위주로 테스트
* 테스트 커버리지가 100%라고 해서 에러가 발생하지 않는 것은 아니다.
* 부하테스트 자체가 중요한게 아니라 병목점과 개선점을 꼼꼼히 단계별로 찾는게 중요하다.
